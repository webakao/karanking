<script>
  const sheetId = "1_hjeo5EjfSx39Ca_iudq3mtqgHKbssua8ySueJTvUpI";
  const sheetName = "categorias"; // ¡IMPORTANTE! debe coincidir con el nombre de la pestaña
  const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;

  const filtroEdad = document.getElementById("filtro-edad");
  const filtroSexo = document.getElementById("filtro-sexo");
  const filtroGrado = document.getElementById("filtro-grado");
  const tablaBody = document.querySelector("#tabla-categorias tbody");

  let datos = [];

  async function cargarDatos() {
    try {
      const response = await fetch(url);
      const csvText = await response.text();
      const filas = csvText.trim().split('\n').map(fila => fila.split(',').map(col => col.trim().replace(/^"|"$/g, '')));

      const encabezados = filas[0];
      const idxCategoria = encabezados.indexOf("CATEGORÍA");
      const idxEdad = encabezados.indexOf("EDAD");
      const idxSexo = encabezados.indexOf("SEXO");
      const idxGrado = encabezados.indexOf("GRADUACIÓN");
      const idxDivision = encabezados.indexOf("DIVISIÓN");

      datos = filas.slice(1).map(fila => ({
        categoria: fila[idxCategoria],
        edad: fila[idxEdad],
        sexo: fila[idxSexo],
        grado: fila[idxGrado],
        division: fila[idxDivision],
      }));

      poblarFiltros();
      mostrarDatos();
    } catch (error) {
      console.error("Error al cargar los datos:", error);
    }
  }

  function poblarFiltros() {
    const edades = [...new Set(datos.map(d => d.edad))].sort();
    const sexos = [...new Set(datos.map(d => d.sexo))].sort();
    const grados = [...new Set(datos.map(d => d.grado))].sort();

    edades.forEach(edad => {
      const option = document.createElement("option");
      option.value = edad;
      option.textContent = edad;
      filtroEdad.appendChild(option);
    });

    sexos.forEach(sexo => {
      const option = document.createElement("option");
      option.value = sexo;
      option.textContent = sexo;
      filtroSexo.appendChild(option);
    });

    grados.forEach(grado => {
      const option = document.createElement("option");
      option.value = grado;
      option.textContent = grado;
      filtroGrado.appendChild(option);
    });
  }

  function mostrarDatos() {
    const edadSeleccionada = filtroEdad.value;
    const sexoSeleccionado = filtroSexo.value;
    const gradoSeleccionado = filtroGrado.value;

    tablaBody.innerHTML = "";

    const datosFiltrados = datos.filter(d =>
      (edadSeleccionada === "" || d.edad === edadSeleccionada) &&
      (sexoSeleccionado === "" || d.sexo === sexoSeleccionado) &&
      (gradoSeleccionado === "" || d.grado === gradoSeleccionado)
    );

    datosFiltrados.forEach(d => {
      const fila = document.createElement("tr");

      const celdaCategoria = document.createElement("td");
      const enlace = document.createElement("a");
      const nombreArchivo = `categoria-${d.categoria.replace(/\s+/g, '-').toLowerCase()}.html`;
      enlace.href = nombreArchivo;
      enlace.textContent = d.categoria;
      celdaCategoria.appendChild(enlace);
      fila.appendChild(celdaCategoria);

      const celdaEdad = document.createElement("td");
      celdaEdad.textContent = d.edad;
      fila.appendChild(celdaEdad);

      const celdaSexo = document.createElement("td");
      celdaSexo.textContent = d.sexo;
      fila.appendChild(celdaSexo);

      const celdaGrado = document.createElement("td");
      celdaGrado.textContent = d.grado;
      fila.appendChild(celdaGrado);

      tablaBody.appendChild(fila);
    });
  }

  filtroEdad.addEventListener("change", mostrarDatos);
  filtroSexo.addEventListener("change", mostrarDatos);
  filtroGrado.addEventListener("change", mostrarDatos);

  cargarDatos();
</script>

